"use strict";(globalThis.webpackChunkwebpack_chopshop=globalThis.webpackChunkwebpack_chopshop||[]).push([[321],{2321:(e,t,n)=>{n.r(t),n.d(t,{default:()=>V});var s=n(4395),r=n(4663),a=n(5228),o=n(3896),i=n(5890),l=n(890),c=n(7482),d=n(2791),h=n(1582),g=n(6463),p=n(1555),u=n(5564),m=n.n(u),f=n(8980),y=n(4273),b=n(763),x=n(5974);const S=Object.values(x).filter((e=>"function"===typeof e)),v=(0,b.memoize)((()=>{p.Y6.set("FILTER",{canHandle:e=>S.includes(e),serialize:e=>[(0,b.findKey)(x,(t=>e===t)),[]],deserialize:e=>x[e]})}));class j{constructor(){this.worker=void 0,this.backend=void 0,this.cache={},this.graph=void 0,this.throttled=void 0,this.calculateGroupSizes=this.implement("calculateGroupSizes"),this.calculateTreeSizeRetainedByNode=this.implement("calculateTreeSizeRetainedByNode"),this.calculateTreeSizeRetainedByEdge=this.implement("calculateTreeSizeRetainedByEdge"),this.calculateTreeSize=this.implement("calculateTreeSize"),this.findChains=this.implement("findChains"),this.findNodeCycles=this.implement("findNodeCycles"),this.getAsyncEdges=this.implement("getAsyncEdges"),this.getDeepNodeChildren=this.implement("getDeepNodeChildren"),this.getEnabledChildEdges=this.implement("getEnabledChildEdges"),this.getEnabledParentEdges=this.implement("getEnabledParentEdges"),this.getNodesRetainedByNode=this.implement("getNodesRetainedByNode"),this.getNodesRetainedByEdge=this.implement("getNodesRetainedByEdge"),this.getDeepNodeParents=this.implement("getDeepNodeParents"),v(),this.setupFreshBackend()}get currentGraph(){return this.graph}setupFreshBackend(){this.worker&&this.worker.terminate(),this.throttled=m()(100),this.worker=new Worker(new URL(n.p+n.u(647),n.b)),this.backend=(0,p.Ud)(this.worker)}implement(e){return(...t)=>{const n=this.graph;if(!n)throw new Error("Graph is not set!");const s=`${n.version}:${e}:${function(...e){let t="";for(const n of e)t+="function"===typeof n?(0,f.ju)(n)+":":"object"===typeof n&&n&&"id"in n?n.id+":":JSON.stringify(n)+":";return t}(...t)}`;if(this.cache[s])return this.cache[s];const r=performance.now(),a=this.throttled((async()=>{if(n.parallel.aborted)throw console.warn("ABORTING",e),n.parallel.aborted;const s=performance.now();try{return await Promise.race([n.parallel.abortSignal,this.backend[e](...t)])}finally{console.log(`[RPC] ${e}: work: ${Math.round(performance.now()-s)}ms queue: ${Math.round(performance.now()-r)}ms`)}}));return this.cache[s]=a,a}}async openGraph(e,t,n){this.setupFreshBackend();const s=await this.backend.openGraph(e,t,(0,p.sj)(n));return this.graph={...s,cache:{},parallel:(0,y.gp)(),revert:[]},this.graph}setGraph(e){this.graph=e,this.cache={},console.time("graph copy");const t=this.backend.setGraph({version:e.version,root:e.root,nodes:e.nodes,edges:e.edges,errors:[]});return console.timeEnd("graph copy"),t}async setGraphAndApplyChanges(e,t){return this.graph=e,this.cache={},this.backend.applyChanges(t)}}var w=n(7773);const k=Symbol("appliedChanges");function T(e,t,n,s){return(0,g.Pj)(e,(e=>{(0,h.VY)(e),(0,h.zb)(e,n),e[k]=n,t.setGraphAndApplyChanges(e,n),s(e)}))}var C=n(6688),E=n(8347),Z=n(4554),N=n(6151),A=n(703),O=n(8096),R=n(7133),L=n(765),P=n(5523),_=n(1419),z=n(7831),B=n(6553),G=n(184);const F=(0,E.ZL)({name:"OpenStatsPage"})({root:{width:"500px",display:"flex",flexDirection:"column",justifyContent:"center",alignSelf:"center",justifySelf:"center",alignItems:"center"}});let D=!1;function M({openGraph:e,trackLoading:t,graphLoadState:n}){const{classes:s,cx:r}=F(),[a,o]=(0,d.useState)(localStorage.getItem("minifySources")||""),i=n&&"progress"in n&&n,h=!i&&n,g=(0,d.useMemo)((()=>({minifySources:"minify"===a||"gzip"===a&&"gzip"})),[a]),p=(0,d.useCallback)((([n],[s])=>{s?t(Promise.reject("Only webpack build stats in json format are accepted!")):e(n,g)}),[e,t,g]);(0,d.useEffect)((()=>{({NODE_ENV:"production",PUBLIC_URL:"/webpack-chopshop",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_STATS&&!D&&(D=!0,e(`/webpack-chopshop/stats/${{NODE_ENV:"production",PUBLIC_URL:"/webpack-chopshop",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_STATS||""}`,g))}),[]);const{getRootProps:u,getInputProps:m,open:f}=(0,z.uI)({multiple:!1,accept:".json",onDrop:p,noClick:!0,noKeyboard:!0,disabled:!!i});return(0,G.jsx)(Z.Z,{onClick:()=>f(),...u({className:r(s.root)}),children:i?(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(c.Z,{variant:"determinate",value:100*i.progress,sx:{marginBottom:1,width:"100%"}}),(0,G.jsxs)(l.Z,{variant:"body2",color:"text.secondary",children:[i.message," ",Math.round(100*i.progress),"%"]})]}):(0,G.jsxs)(G.Fragment,{children:[h&&(0,G.jsx)(B.Z,{error:h}),(0,G.jsx)("input",{...m()}),(0,G.jsxs)(l.Z,{variant:"body1",sx:{marginTop:2,marginBottom:2,textAlign:"center"},children:["First, generate the stats file in webpack, then click below",(0,G.jsx)("br",{}),"or drop it anywhere on the page to start"]}),(0,G.jsx)(N.Z,{variant:"contained",onClick:()=>f(),children:"Open stats file"}),(0,G.jsx)(A.Z,{variant:"outlined",sx:{marginTop:4,padding:2},children:(0,G.jsxs)(O.Z,{component:"fieldset",children:[(0,G.jsx)(R.Z,{component:"legend",children:"Module sizes"}),(0,G.jsxs)(L.Z,{row:!0,value:a,onChange:e=>{const t=e.target.value;o(t),localStorage.setItem("minifySources",t)},children:[(0,G.jsx)(P.Z,{value:"",control:(0,G.jsx)(_.Z,{}),label:"As-is"}),(0,G.jsx)(P.Z,{value:"minify",control:(0,G.jsx)(_.Z,{}),label:"Minified"}),(0,G.jsx)(P.Z,{value:"gzip",control:(0,G.jsx)(_.Z,{}),label:"GZipped"})]})]})})]})})}var W=n(1964),$=n(5018);const I=(0,E.ZL)({name:"WarningBar"})((e=>({root:{background:$.Z.A700,padding:"8px 24px 8px 24px",display:"flex",alignItems:"center",flexShrink:0,justifyContent:"center",height:"max-content"},icon:{marginRight:8}})));function K({children:e}){const{classes:t}=I();return(0,G.jsxs)("div",{className:t.root,children:[(0,G.jsx)(W.Z,{className:t.icon}),(0,G.jsx)("span",{children:e})]})}const H=(0,d.lazy)((()=>Promise.all([n.e(392),n.e(548),n.e(437)]).then(n.bind(n,2437)))),J=(0,d.lazy)((()=>Promise.all([n.e(392),n.e(258)]).then(n.bind(n,7258)))),U=(0,E.ZL)({name:"App"})((e=>({root:{display:"grid",gridAutoFlow:"row",gridAutoRows:"auto 1fr",height:"100vh"},container:{width:"100vw",marginLeft:"auto",marginRight:"auto"},title:{marginLeft:"auto",textTransform:"uppercase"},search:{color:"#fff",borderBottom:"2px solid #fff",width:300},dropzone:{},openButton:{},progress:{},openFileMessage:{textAlign:"center",width:"30em",alignSelf:"center",margin:"auto",cursor:"pointer"}})));function V({className:e,trackLoading:t}){const{classes:n,cx:g}=U(),[p,u]=(0,d.useState)("open"),{graph:m,graphWorker:f,graphLoadState:y,openGraph:b,changes:x,updateChanges:S}=function({trackLoading:e,onLoaded:t}){const[n,s]=(0,d.useState)(null),[r,a]=(0,d.useState)(),o=(0,d.useMemo)((()=>new j),[]),[i,l]=(0,w.bA)(),[c,g]=(0,d.useMemo)((()=>[i.changes,e=>l((t=>({...t,changes:e(t.changes)})))]),[i,l]),p=(0,d.useCallback)((async(n,i)=>{e((async()=>{try{let e;r&&r.parallel.abort();const l=(t,n)=>{t===e&&1!==n||(e&&console.timeEnd(`[Open] ${e}`),1!==n&&console.time(`[Open] ${t}`),e=t),console.log(t,n),s(1===n?null:{message:t,progress:n})};l("initializing",0);const d=await o.openGraph(n,i,l);l("applying changes",.9),T(d,o,c,a),l("done",1),t()}catch(e){console.error(e),s(e)}})())}),[e,r,o,c,t]);return(0,d.useEffect)((()=>{r&&((0,h.h9)(c)||0!==r.revert.length)&&r[k]!==c&&T(r,o,c,a)}),[r,c,o]),{graph:r,graphWorker:o,graphLoadState:n,openGraph:p,changes:c,updateChanges:g}}({trackLoading:t,onLoaded:()=>u("tree/async")}),[v,E]=function(){const[e,t]=(0,d.useReducer)(((e,t)=>{let n;if(Array.isArray(t))n=t;else{var s;const{id:r}=t,a=e.includes(r),o=null!==(s=t.set)&&void 0!==s?s:!a;if(a===o)return e;n=o?[r,...e]:e.filter((e=>e!==r))}return window.localStorage.setItem("pinned",JSON.stringify(n)),n}),[]);return(0,d.useEffect)((()=>{try{t(JSON.parse(window.localStorage.getItem("pinned")||"[]"));const e=e=>{"pinned"===e.key&&e.newValue&&t(JSON.parse(e.newValue))};return window.addEventListener("storage",e),()=>{window.removeEventListener("storage",e)}}catch(e){console.error("Local storage failed to initialize",e)}}),[]),[e,t]}();let Z=null;return m&&"open"!==p?m&&p.startsWith("tree/")?Z=(0,G.jsx)(H,{className:n.container,graph:m,graphWorker:f,pinned:v,togglePinned:E,updateChanges:S,trackLoading:t,mode:"tree/async"===p?"async":"tree/modules"===p?"modules":"tree/cycles"===p?"cycles":"modules"}):m&&"changes"===p&&(Z=(0,G.jsx)(J,{graph:m,changes:x,pinned:v,updateChanges:S})):Z=(0,G.jsx)(M,{openGraph:b,trackLoading:t,graphLoadState:y}),(0,G.jsxs)("div",{className:g(n.root,e),children:[(0,G.jsx)(s.Z,{position:"static",color:"primary",children:(0,G.jsxs)(r.Z,{className:n.container,variant:"dense",children:[(0,G.jsxs)(a.Z,{value:p,indicatorColor:"secondary",textColor:"inherit",onChange:(e,t)=>u(t),children:[(0,G.jsx)(o.Z,{value:"open",label:"Open stats"}),(0,G.jsx)(o.Z,{disabled:!m,value:"tree/async",label:"Split points"}),(0,G.jsx)(o.Z,{disabled:!m,value:"tree/modules",label:"Modules"}),(0,G.jsx)(o.Z,{disabled:!m,value:"tree/cycles",label:"Cycles"}),(0,G.jsx)(o.Z,{disabled:!m,value:"changes",label:(0,G.jsx)(i.Z,{badgeContent:(0,h.Jg)(x),invisible:0===(0,h.Jg)(x),color:"secondary",children:"Show changes"})})]}),(0,G.jsx)(l.Z,{variant:"h6",color:"inherit",className:n.title,children:"Webpack Chop Shop"})]})}),(0,G.jsx)(C.Z,{fallback:(0,G.jsx)(c.Z,{className:n.progress}),children:Z}),m&&m.errors.length>0&&(0,G.jsxs)(K,{children:["There where ",m.errors.length," errors found. Check the console for more"]})]})}},1582:(e,t,n)=>{n.d(t,{h9:()=>a,Jg:()=>o,j6:()=>i,v2:()=>l,VY:()=>c,zb:()=>d});var s=n(763),r=n(6463);function a(e){return e.edgeToggles&&Object.values(e.edgeToggles).length>0||!1}function o(e){return e.edgeToggles?Object.values(e.edgeToggles).reduce(((e,t)=>e+(t?0:1)),0):0}function i(e,t,n,r){return r!==(!!n&&("mocked"!==n.kind&&!n.async))?{...t,edgeToggles:{...t.edgeToggles,[n.id]:r}}:t.edgeToggles&&null!=t.edgeToggles[n.id]?{...t,edgeToggles:(0,s.omit)(t.edgeToggles,[n.id])}:t}function l(e,t){return{edgeToggles:(0,s.omitBy)(e.edgeToggles||{},(e=>e===t))}}function c(e){for(const t of e.revert.reverse())t();e.revert.splice(0)}function d(e,t){for(const[n,s]of Object.entries(t.edgeToggles||{})){const t=(0,r.a3)(e,n);if(!t){e.errors.push({message:`Edge ${n} doesnt exist`});continue}const a=t.enabled;e.revert.push((()=>{(0,r.ty)(e,t,a)})),(0,r.ty)(e,t,s)}}},8980:(e,t,n)=>{n.d(t,{ju:()=>a,$M:()=>o});n(763),n(6463);const s=new WeakMap;let r=0;function a(e){return e?(s.has(e)||s.set(e,`${e.name}${++r}`),s.get(e)):""}const o="last"},5974:(e,t,n)=>{n.r(t),n.d(t,{currentGraphFilter:()=>r,baseGraphFilter:()=>a,stopOnAsyncModulesFilter:()=>o,allAsyncAndEnabledFilter:()=>i});var s=n(8980);function r(e){return e.enabled}function a(e){return!e.async||e.enabled}function o(e){return!e.async||s.$M}function i(e){return e.async||e.enabled}}}]);
//# sourceMappingURL=321.5e3bdae5.chunk.js.map